ğŸ” What is Entity Detection?

Entity detection = extracting key info from userâ€™s question.

â“ â€œWhat did Priya do using Python?â€

Intent: DETAILED_CONTEXT_QUERY
Entities:
	â€¢	Candidate Name: "Priya"
	â€¢	Skill/Keyword: "Python"

Abhay - I got an idea based on the name we are getting we can train our ner on these names 

               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚        USER INTERFACE        â”‚
               â”‚ (chat + candidate selector)  â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚     NLP INTERPRETER (LLM)    â”‚
               â”‚ â†’ Intent                     â”‚
               â”‚ â†’ Entities (names, skills)   â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Candidate    â”‚      â”‚ Context Tracker      â”‚
     â”‚ Scope Filter â”‚      â”‚ (LangGraph memory)   â”‚
     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–¼                          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ SQL Query Engine       â”‚  â”‚ Chroma Vector Search   â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼                                  â–¼
           â””â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”˜
                 â–¼                      â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Candidate Context Joiner      â”‚
          â”‚  (exp, projects, skills, etc.) â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    Response Generator (LLM)  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User asks:
  â“ â€œTell me about Priyaâ€
  OR selects Priya from UI and asks: â“ â€œGive me her experience with Pythonâ€

â†’ System checks:

1. Is candidate selected from UI?
   â†’ Yes â†’ Use it as scope
   â†’ No â†’ Try name/entity detection (NER)
      - If 1 match found â†’ Use it
      - If >1 matches â†’ Ask user: "Which Priya did you mean?"
      - If 0 matches â†’ Return error or ask to select

2. Search type:
   â†’ SQL or Vector or Both (LLM decides)

3. Return LLM-formatted summary, with:
   - Experience
   - Projects
   - Notes (if stage >1)
   - Skills (ranked)


   CREATE TABLE interview_notes (
  note_id UUID PRIMARY KEY,
  candidate_email TEXT,
  pipeline_stage TEXT,
  author TEXT,
  content TEXT,
  created_at TIMESTAMPTZ DEFAULT now()
);






------------------------------------------------Reference Document------------------------------------------------------------------




Absolutely! Letâ€™s compile the full Backend High-Level Design (HLD) Document for your Intelligent HR Assistant System â€” built to answer 40+ types of scoped and contextual resume queries using a hybrid SQL + vector + LLM architecture.

â¸»

ğŸ§  Intelligent HR Assistant â€“ Backend HLD

Version: 1.0
Author: [You]
Date: August 2025

â¸»

ğŸ¯ Objective

Build an intelligent backend system to:
	â€¢	Answer natural language queries about candidates from resume data.
	â€¢	Support scoped (selected candidate(s)) and unscoped queries.
	â€¢	Combine SQL + Vector Search + LLM for rich, contextual answers.
	â€¢	Handle multiple query types: count, semantic, summarization, ranking, detailed.
	â€¢	Be able to retrieve pipeline-stage interview notes for deeper comparison.

â¸»

ğŸ—ï¸ Architecture Overview

ğŸ” High-Level Flow:

User Query (via UI)
     â”‚
     â–¼
[Intent + Entity Detector (LLM)]
     â”‚
     â–¼
[Scope Determiner]
     â”‚
     â–¼
[Query Engine Router]
  â”œâ”€â”€â–º SQL Engine
  â”œâ”€â”€â–º Chroma Vector Search
  â””â”€â”€â–º Hybrid Joiner
     â”‚
     â–¼
[Candidate Context Joiner]
     â”‚
     â–¼
[Response Generator (LLM)]
     â”‚
     â–¼
Final Chat Response


â¸»

ğŸ—ƒï¸ Supported Query Types with Examples

Type	Example
ğŸ“Š Count	â€œHow many candidates did internships?â€
ğŸ” Semantic	â€œWho worked on deep learning?â€
ğŸ§¾ Summarization	â€œTell me about Abhay Sharma.â€
ğŸ“ˆ Skill Ranking	â€œWhat are Priyaâ€™s top 5 skills?â€
ğŸ“‚ Detailed Context	â€œWhat did Sneha do using Python?â€
ğŸ§‘â€ğŸ’» Comparison	â€œCompare Abhay and Priyaâ€ (when two selected)
ğŸ—’ï¸ Interview Context	â€œWhy was Rahul promoted to assessment stage?â€


â¸»

ğŸ“ Folder & Module Structure

â”œâ”€â”€ agent/
â”‚   â”œâ”€â”€ agent_core.py              # Main agent logic
â”‚   â””â”€â”€ scheduler_agent.py         # For pipeline automation (optional)
â”œâ”€â”€ embedding/
â”‚   â”œâ”€â”€ chunking_utils.py          # Resume chunk logic
â”‚   â”œâ”€â”€ embedder.py                # Text â†’ embeddings
â”‚   â””â”€â”€ ingest_resume_to_chroma.py # Vector DB ingestion script
â”œâ”€â”€ tools/
â”‚   â”œâ”€â”€ vector_tool.py             # Chroma search utility
â”‚   â”œâ”€â”€ sql_tool.py                # SQL execution
â”‚   â”œâ”€â”€ candidate_scope.py         # Candidate selector (UI + fallback NER)
â”‚   â”œâ”€â”€ context_joiner.py          # Resume info retriever (exp, projects, etc.)
â”‚   â”œâ”€â”€ name_matcher.py            # Match query names to resume DB
â”‚   â””â”€â”€ notes_tool.py              # Interview notes access
â”œâ”€â”€ llm_router.py                  # Orchestration: classify + route + combine
â”œâ”€â”€ app.py                         # FastAPI entrypoint
â”œâ”€â”€ config.py                      # Environment vars, keys
â”œâ”€â”€ .env


â¸»

âš™ï¸ Key Modules Explained

1. llm_router.py
	â€¢	Handles incoming query + selection.
	â€¢	Detects intent and fallback entities (NER).
	â€¢	Routes to appropriate tools.
	â€¢	Combines SQL/Vector outputs if both useful.

2. vector_tool.py
	â€¢	Uses OpenAI to embed query.
	â€¢	Calls ChromaDB for scoped semantic search.
	â€¢	Supports UI scope filtering via email(s).

3. sql_tool.py
	â€¢	Maps high-confidence SQL queries.
	â€¢	Uses templates or GPT-generated SQL with safety checks.

4. candidate_scope.py
	â€¢	If UI provides email(s), uses that.
	â€¢	If not, tries NER + fuzzy matching to infer candidate name from query.
	â€¢	Handles disambiguation (â€œwhich Priya?â€).

5. context_joiner.py
	â€¢	Pulls structured resume info:
	â€¢	Experience, bullets
	â€¢	Projects, tech stack
	â€¢	Skills + proficiency
	â€¢	Education, certifications
	â€¢	Publications, achievements

6. notes_tool.py
	â€¢	Stores and retrieves stage-wise notes.
	â€¢	Used in response generation for deeper insight during comparisons.

â¸»

ğŸ§  Candidate Scope Strategy

Source of Scope	Logic
âœ… UI selection	Primary method (most reliable)
ğŸ”„ NER fallback	If no selection, infer from query
â“ Multi-match	Ask user to choose
âŒ No match	Ask user to clarify


â¸»

ğŸ¤– Query Routing Examples

â“ â€œList candidates who have done internships.â€
	â€¢	Intent: DATABASE_SQL
	â€¢	Route: SQL only
	â€¢	Output: List from experience where employment_type = Internship

â¸»

â“ â€œWho worked on deep learning?â€
	â€¢	Intent: SEMANTIC_QUERY
	â€¢	Route: Vector search
	â€¢	Output: Top 5 candidates from experience/project bullets mentioning â€œdeep learningâ€

â¸»

â“ â€œWhat did Priya do using Python?â€
	â€¢	Intent: DETAILED_CONTEXT_QUERY
	â€¢	Scope: Determined by UI or NER
	â€¢	Route: SQL and Vector (hybrid)
	â€¢	Output: Contextual bullet sentences + structured summary

â¸»

â“ â€œCompare Abhay and Rahul.â€
	â€¢	Intent: COMPARISON_QUERY
	â€¢	Scope: [abhay@example.com, rahul@example.com]
	â€¢	Route: Structured context join + skills + notes
	â€¢	Output: Summary of both + comparison table

â¸»

ğŸ§ª Error Handling / Fallbacks

Case	LLM Response
SQL returns nothing	â€œNo structured match found. Want me to try a semantic search?â€
Vector empty	â€œCouldnâ€™t find relevant content. Try rephrasing?â€
Scope not found	â€œI couldnâ€™t find a candidate named X. Please select from the list.â€
Multiple name matches	â€œDid you mean Priya Sharma or Priya Das?â€


â¸»

ğŸ“Œ Final Notes
	â€¢	Interview notes will be injected into context only in post-shortlist pipelines.
	â€¢	LLMs will be used for:
	â€¢	Summarization
	â€¢	Response generation
	â€¢	Comparison formatting
	â€¢	Later stages can auto-analyze note sentiment or flag risky cases.

â¸»

âœ… Ready for Code?

If this looks aligned, I can now start writing each real file â€” beginning with:
	â€¢	vector_tool.py
	â€¢	candidate_scope.py
	â€¢	llm_router.py

Letâ€™s lock this HLD and start coding. Want me to start with vector_tool.py?



âœ… Feature Implementation Order
	1.	vector_tool.py
	2.	sql_tool.py
	3.	candidate_scope.py
	4.	name_matcher.py
	5.	context_joiner.py
	6.	llm_router.py
	7.	app.py (API routes)
	8.	Frontend: send query + selected candidates
	9.	notes_tool.py + DB table for interview notes
	10.	Add scoped comparison logic in router
	11.	Add fallback NER logic for unscoped queries
	12.	Add interview-stage note injection in context
	13.	Add pipeline-aware prompt tailoring (optional)
	14.	Add UI feature: note input on stage transition
	15.	Add memory / context tracker (LangGraph or custom)